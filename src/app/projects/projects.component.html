<h1 class="display-5 text-center mb-5">Projects <button *ngIf="user.role === UserRole.ADMIN || user.role === UserRole.MANAGER" class="btn btn-sm btn-danger" data-bs-toggle="modal" data-bs-target="#createProjectModal">New</button></h1>





<ng-container *ngIf="(appState$ | async) as appState" [ngSwitch]="appState.dataState">
  <ng-container *ngSwitchCase="DataState.LOADING_STATE">
    <div class="col-md-12 single-note-item text-center">
        <div class="spinner-border text-info" role="status"></div>
    </div>
  </ng-container>
  <ng-container  *ngSwitchCase="DataState.LOADED_STATE">
    <div *ngFor="let project of appState.appData.dtos">
      <div class="row d-flex justify-content-center mb-5">
        <div class="col-md-12 shadow bg-light px-4 py-3">
            <div class="row mb-3">
                <div class="col-7">
                    <span class="text-dark lead">{{project.name}}</span>
                    <button *ngIf="user.role === UserRole.ADMIN || user.role === UserRole.MANAGER || (user.role === UserRole.LEAD_DEV && user.username === project.leadDevUsername)" class="btn neutralButton p-0 ms-2 mb-2" data-bs-toggle="modal"
                        [attr.data-bs-target]="'#editProject' + project.id + 'Modal'">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-pencil-fill" viewBox="0 0 16 16">
                            <path
                                d="M12.854.146a.5.5 0 0 0-.707 0L10.5 1.793 14.207 5.5l1.647-1.646a.5.5 0 0 0 0-.708l-3-3zm.646 6.061L9.793 2.5 3.293 9H3.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.5h.5a.5.5 0 0 1 .5.5v.207l6.5-6.5zm-7.468 7.468A.5.5 0 0 1 6 13.5V13h-.5a.5.5 0 0 1-.5-.5V12h-.5a.5.5 0 0 1-.5-.5V11h-.5a.5.5 0 0 1-.5-.5V10h-.5a.499.499 0 0 1-.175-.032l-.179.178a.5.5 0 0 0-.11.168l-2 5a.5.5 0 0 0 .65.65l5-2a.5.5 0 0 0 .168-.11l.178-.178z" />
                        </svg>
                        <!-- <img class="ms-2" src="/assets/img/delete-icon.svg" width="22px" height="22px"> -->
                    </button>
                </div>
                <div class="col-5 d-flex justify-content-end align-items-center">
                    Created: {{project.createdOn}}
                </div>
            </div>
            <div class="row mb-3">
                <button class="text-start text-secondary neutralButton" style="cursor: default">
                    {{project.description}}
                </button>
            </div>
            <div class="row">
                <div class="col-md-8 d-flex">
                    <span class="text-truncate d-inline">
                        <span class="fontSizeLarge">Lead dev: </span>
                        <span class="{{project.leadDevUsername ? 'fst-italic text-success fw-bold' : 'text-danger'}}">{{project.leadDevUsername ? project.leadDevUsername : 'unassigned'}}</span>
                    </span>
                </div>
                <div class="col-md-4 d-flex justify-content-end mt-md-0 mt-3">
                    <a href="#">
                        <button
                            class="btn btn-dark text-light btn-sm border-0 rounded-0 px-4 py-2 text-uppercase">View
                            Tickets</button>
                    </a>
                </div>
            </div>
        </div>
      </div>

      <div class="modal fade" id="editProject{{project.id}}Modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content rounded-0">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Project</h5>
                    <button id="closeUpdateProject{{project.id}}ModalBtn" type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <form #updateProjectForm="ngForm" (ngSubmit)="updateProject(updateProjectForm)">
                    <div class="modal-body mx-3">
                        <input type="hidden" name="id" [ngModel]="project.id">

                        <div class="row mb-3">
                            <label for="project{{project.id}}Name" class="mb-2">Name:</label>
                            <input ngModel [(ngModel)]="project.name" type="text" name="name" id="project{{project.id}}Name" class="form-control rounded-0"
                                placeholder="{{project.name}}"  required>

                        </div>
                        <div class="row mb-3">
                            <label for="project{{project.id}}Description" class="mb-2">Description:</label>
                            <textarea ngModel [(ngModel)]="project.description" name="description" id="project{{project.id}}Description" rows="10"
                                class="rounded-0 pt-2"
                                required></textarea>
                        </div>
                    </div>

                    <div class="modal-footer position-relative">
                      <button *ngIf="user.role === UserRole.ADMIN" type="button" class="btn btn-sm btn-danger rounded-0 position-absolute start-0 ms-4"
                            data-bs-dismiss="modal"
                            data-bs-toggle="modal" [attr.data-bs-target]="'#deleteProject' + project.id + 'Modal'">Delete</button>
                        <button type="button" class="btn btn-secondary rounded-0"
                            data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-dark rounded-0">Save</button>
                    </div>
                  </form>
            </div>
        </div>
      </div>

      <div class="modal fade" id="deleteProject{{project.id}}Modal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content rounded-0">
                <div class="modal-header">
                    <h5 class="modal-title">Are you sure?</h5>
                    <button id="closeDeleteProject{{project.id}}ModalBtn" type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>

                <div class="modal-body">{{project.name}} is to be deleted</div>

                <form #deleteProjectForm="ngForm" (ngSubmit)="deleteProject(deleteProjectForm)">

                  <input type="hidden" name="id" [ngModel]="project.id">

                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary rounded-0"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-danger rounded-0">Delete</button>
                  </div>
                </form>
            </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="createProjectModal" tabindex="-1">
      <div class="modal-dialog">
          <div class="modal-content rounded-0">
              <div class="modal-header">
                  <h5 class="modal-title">New Project</h5>
                  <button id="closeCreateProjectModalBtn" type="button" class="btn-close" data-bs-dismiss="modal"></button>
              </div>

              <form #createProjectForm="ngForm" (ngSubmit)="createProject(createProjectForm)">
                  <div class="modal-body mx-3">
                      <div class="row mb-3">
                          <label for="newProjectName" class="mb-2">Name:</label>
                          <input ngModel type="text" name="name" id="newProjectName" class="form-control rounded-0" required>

                      </div>
                      <div class="row mb-3">
                          <label for="newProjectDescription" class="mb-2">Description:</label>
                          <textarea ngModel name="description" id="newProjectDescription" rows="10"
                              class="rounded-0 pt-2"
                              required></textarea>
                      </div>
                  </div>

                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary rounded-0"
                        data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-dark rounded-0">Save</button>
                </div>
              </form>



          </div>
      </div>
    </div>
  </ng-container>
  <ng-container *ngSwitchCase="DataState.ERROR_STATE">
    <div class="alert alert-danger">
        {{appState.error}}
    </div>
  </ng-container>
</ng-container>
